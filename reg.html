<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
    <title>Register for a Visa</title>
    <link rel="icon" href="logo/lrp.png">
</head>

<body>
<CENTER>

<h1>‚ÄúLegendary Roleplay SAMP:TAMIL SERVER‚Äù</h1>
<img src="logo/lrpGIF.gif">
<h3>VISA APPLY FORM üëáüèº</h3>

<form id="visaForm" enctype="multipart/form-data"> 
    <table border="1">

        <tr>
            <td>NAME</td>
            <td><input type="text" name="pname" placeholder="ENTER YOUR NAME" required></td>
        </tr>

        <tr>
            <td>DC NAME</td>
            <td><input type="text" name="dname" placeholder="ENTER YOUR DISCORD NAME" required></td>
        </tr>

        <tr>
            <td>AGE</td>
            <td><input type="number" name="age" placeholder="ENTER YOUR AGE" required></td>
        </tr>

        <tr>
            <td>UPLOAD YOUR DISCORD PROFILE</td>
            <td><input type="file" name="discord_profile_pic"></td>
        </tr>

        <tr>
            <td>ROLEPLAY EXPERIENCE</td>
            <td>
                <select name="experience">
                    <option value="none">none</option>
                    <option value="No Experience">No Experience</option>
                    <option value="Experienced">Experienced</option>
                </select>
            </td>
        </tr>

    </table><br>

    <input type="submit" value="Submit Visa Application"><br><br>
    <input type="reset" value="Clear Form">
</form>

</CENTER>

<hr>

<div class="social-row">
    <a href="index.html" class="social-item">
        <img src="logo/lrp.png" alt="Home">
        <span>Home</span>
    </a>

    <a href="https://discord.gg/M76QgHhw" target="_blank" class="social-item">
        <img src="logo/discord.png" alt="Discord">
        <span>Discord</span>
    </a>

    <a href="https://www.instagram.com/legendary.roleplay.samp?igsh=Zm45N3pzZjh5czVl"
        target="_blank" class="social-item">
        <img src="logo/instagram.png" alt="Instagram">
        <span>Instagram</span>
    </a>

    <a href="https://youtube.com/@legendarysamproleplayoffic6873?si=bAXFBKuRw1tk4TyA"
        target="_blank" class="social-item">
        <img src="logo/yt.png" alt="YouTube">
        <span>YouTube</span>
    </a>
</div>

<script>
    const visaForm = document.getElementById('visaForm');
    
    // ‚ö†Ô∏è IMPORTANT SECURITY WARNING: 
    // This URL is publicly shared. You must change it immediately in your Discord settings!
    const WEBHOOK_URL = 'https://discord.com/api/webhooks/1449670444134170626/YpaVBCmeBTrPLDj9ZfIK1YsV8IGRJAf9sXCVfAoPzwz3Xt0itV62wjO3Eqj8hrnyAjbG';
    
    // Role ID to be mentioned (tagged) in the Discord message
    const ROLE_ID = '1449718757881806980'; 

    visaForm.addEventListener('submit', function(event) {
        event.preventDefault();
        
        alert('Submitting application... Please wait!');
        
        const formData = new FormData(visaForm);
        const discordProfilePic = formData.get('discord_profile_pic');
        
        // 1. Build the JSON payload for the embedded message and the role tag
        const payload = {
            username: 'Visa Application Bot',
            avatar_url: 'https://i.imgur.com/your-bot-avatar.png', // Replace with a real avatar URL
            
            // This is how you mention a role/user outside of an embed (must be a string)
            content: `New Visa Application Received! <@&${ROLE_ID}>`, 
            
            embeds: [{
                title: "New VISA Application Received",
                color: 3447003, // A nice blue color
                fields: [
                    { name: "Applicant Name", value: formData.get('pname'), inline: true },
                    { name: "Discord Name", value: formData.get('dname'), inline: true },
                    { name: "Age", value: formData.get('age'), inline: true },
                    { name: "RP Experience", value: formData.get('experience'), inline: false },
                ],
                timestamp: new Date().toISOString()
            }]
        };
        
        // 2. Prepare the final FormData for the webhook request
        const webhookFormData = new FormData();
        
        // If a file was uploaded, append it to the form data
        if (discordProfilePic && discordProfilePic.name) {
            webhookFormData.append('file', discordProfilePic, discordProfilePic.name);
        }

        // Append the JSON payload as a string under the key 'payload_json'
        webhookFormData.append('payload_json', JSON.stringify(payload));

        // 3. Send the request
        fetch(WEBHOOK_URL, {
            method: 'POST',
            body: webhookFormData
        })
        .then(response => {
            if (response.ok) {
                alert('‚úÖ Application submitted successfully! Thank you.');
                visaForm.reset();
                // Optional: Redirect the user to a "Thank You" page
                // window.location.href = "success.html";
            } else {
                console.error('Webhook error:', response.status, response.statusText);
                alert(`‚ùå Submission failed. Discord server error: ${response.status}. Please check console.`);
            }
        })
        .catch(error => {
            console.error('Network Error:', error);
            alert('‚ùå Submission failed due to a network error. Please try again.');
        });
    });
</script>

</body>
</html>

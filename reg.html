<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
    <title>Register for a Visa</title>
    <link rel="icon" href="logo/lrp.png">
</head>

<body>
<CENTER>

<h1>‚ÄúLegendary Roleplay SAMP:TAMIL SERVER‚Äù</h1>
<img src="logo/lrpGIF.gif">
<h3>VISA APPLY FORM üëáüèº</h3>

<form id="visaForm" enctype="multipart/form-data">
    <table border="1">

        <tr>
            <td>NAME</td>
            <td><input type="text" name="pname" placeholder="ENTER YOUR NAME" required></td>
        </tr>

        <tr>
            <td>DC NAME</td>
            <td><input type="text" name="dname" placeholder="ENTER YOUR DISCORD NAME" required></td>
        </tr>

        <tr>
            <td>AGE</td>
            <td><input type="number" name="age" placeholder="ENTER YOUR AGE" required></td>
        </tr>

        <tr>
            <td>UPLOAD YOUR DISCORD PROFILE</td>
            <td><input type="file" name="discord_profile_pic"></td>
        </tr>

        <tr>
            <td>ROLEPLAY EXPERIENCE</td>
            <td>
                <select name="experience">
                    <option value="none">none</option>
                    <option value="No Experience">No Experience</option>
                    <option value="Experienced">Experienced</option>
                </select>
            </td>
        </tr>

    </table><br>

    <input type="submit" value="Submit Visa Application"><br><br>
    <input type="reset" value="Clear Form">
</form>

</CENTER>

<hr>

<div class="social-row">
    <a href="index.html" class="social-item">
        <img src="logo/lrp.png" alt="Home">
        <span>Home</span>
    </a>

    <a href="https://discord.gg/M76QgHhw" target="_blank" class="social-item">
        <img src="logo/discord.png" alt="Discord">
        <span>Discord</span>
    </a>

    <a href="https://www.instagram.com/legendary.roleplay.samp?igsh=Zm45N3pzZjh5czVl"
       target="_blank" class="social-item">
        <img src="logo/instagram.png" alt="Instagram">
        <span>Instagram</span>
    </a>

    <a href="https://youtube.com/@legendarysamproleplayoffic6873?si=bAXFBKuRw1tk4TyA"
       target="_blank" class="social-item">
        <img src="logo/yt.png" alt="YouTube">
        <span>YouTube</span>
    </a>
</div>

<script>
    const visaForm = document.getElementById('visaForm');
    const WEBHOOK_URL = 'https://discord.com/api/webhooks/1449670444134170626/YpaVBCmeBTrPLDj9ZfIK1YsV8IGRJAf9sXCVfAoPzwz3Xt0itV62wjO3Eqj8hrnyAjbG';

    visaForm.addEventListener('submit', function(event) {
        event.preventDefault();
        
        alert('Submitting application... Please wait!');
        
        const formData = new FormData(visaForm);
        const discordProfilePic = formData.get('discord_profile_pic');
        
        const payload = {
            username: 'Visa Application Bot',
            avatar_url: 'https://i.imgur.com/your-bot-avatar.png', 
            embeds: [{
                title: "New VISA Application Received",
                color: 3447003,
                fields: [
                    { name: "Applicant Name", value: formData.get('pname'), inline: true },
                    { name: "Discord Name", value: formData.get('dname'), inline: true },
                    { name: "Age", value: formData.get('age'), inline: true },
                    { name: "RP Experience", value: formData.get('experience'), inline: false },
                ],
                timestamp: new Date().toISOString()
            }]
        };
        
        const webhookFormData = new FormData();
        
        if (discordProfilePic && discordProfilePic.name) {
            webhookFormData.append('file', discordProfilePic, discordProfilePic.name);
        }

        webhookFormData.append('payload_json', JSON.stringify(payload));

        fetch(WEBHOOK_URL, {
            method: 'POST',
            body: webhookFormData
        })
        .then(response => {
            if (response.ok) {
                alert('‚úÖ Application submitted successfully! Thank you.');
                visaForm.reset();
            } else {
                console.error('Webhook error:', response.status, response.statusText);
                alert('‚ùå Submission failed. Discord server error. Check console.');
            }
        })
        .catch(error => {
            console.error('Network Error:', error);
            alert('‚ùå Submission failed due to a network error. Please try again.');
        });
    });
</script>
</body>
</html>
<script>
document.getElementById("visaForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);

    // The Discord Webhook URL is placed here directly (taken from your PHP file)
    const webhookUrl = "https://discord.com/api/webhooks/1449507888790769856/1v2xwndqudM2XwPDYdY5yMLV38K5Te3neI764hV4ysBNKvZKPh6xzNSbCgAHci1Vyr5G";

    // Extracting data from the form
    const name = formData.get('pname');
    const dcname = formData.get('dname');
    const age = formData.get('age');
    const experience = formData.get('experience');

    // Building the JSON payload for Discord, matching your PHP structure
    const payload = {
        username: "LRP Visa System (JS)",
        avatar_url: "https://i.imgur.com/4M34hi2.png",
        embeds: [{
            title: "üìù New Visa Application (JS Submission)",
            color: 15844367, // Decimal color code
            fields: [{
                name: "üë§ Name",
                value: name,
                inline: true
            }, {
                name: "üéÆ Discord Name",
                value: dcname,
                inline: true
            }, {
                name: "üéÇ Age",
                value: age,
                inline: true
            }, {
                name: "üìå Roleplay Experience",
                value: experience,
                inline: false // Full-width for the experience description
            }],
            footer: {
                text: "Legendary Roleplay | Visa Application"
            },
            timestamp: new Date().toISOString()
        }]
    };

    // Sending the request directly to the Discord API
    fetch(webhookUrl, {
        method: "POST",
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
    })
    .then(response => {
        if (response.ok) {
            // Success: Redirect to success.html
            window.location.href = "success.html";
        } else {
            // Failure: Display the error, but the redirect fails.
            alert("Submission failed! Status: " + response.status + ". Check Discord log.");
            console.error('Discord API response error:', response.statusText);
        }
    })
    .catch(err => {
        // Network failure (e.g., no internet)
        alert("Network error: Could not reach Discord!");
        console.error(err);
    });
});
</script>

</body>
</html>
